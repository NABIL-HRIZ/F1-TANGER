# F1 MODELS BUSINESS LOGIC FUNCTIONS REFERENCE
# =====================================================
# This file contains all business logic functions that were removed from models
# These functions should be implemented in their respective controllers

## ğŸï¸ LAP MODEL FUNCTIONS (LapController)
## ====================================================

### Time Conversion Functions:
```php
// Convert lap time "01:28:13" to seconds (88.013)
public function convertLapTimeToSeconds($lapTime) {
    $parts = explode(':', $lapTime);
    $minutes = (int) $parts[0];
    $seconds = (int) $parts[1];
    $milliseconds = (int) $parts[2];
    return ($minutes * 60) + $seconds + ($milliseconds / 1000);
}

// Convert lap time "01:28:13" to milliseconds (88013)
public function convertLapTimeToMilliseconds($lapTime) {
    $parts = explode(':', $lapTime);
    $minutes = (int) $parts[0];
    $seconds = (int) $parts[1];
    $milliseconds = (int) $parts[2];
    return ($minutes * 60 * 1000) + ($seconds * 1000) + $milliseconds;
}
```

### Query Functions:
```php
// Get laps for specific race
public function getLapsForRace($raceId) {
    return Lap::where('race_id', $raceId)->get();
}

// Get laps for specific driver
public function getLapsForDriver($driverId) {
    return Lap::where('driver_id', $driverId)->get();
}

// Get laps for specific car
public function getLapsForCar($carId) {
    return Lap::where('car_id', $carId)->get();
}

// Get laps for specific team
public function getLapsForTeam($teamId) {
    return Lap::where('team_id', $teamId)->get();
}

// Get fastest lap in race
public function getFastestLapInRace($raceId) {
    return Lap::where('race_id', $raceId)->orderBy('lap_time')->first();
}

// Get driver's best lap in race
public function getDriverBestLap($raceId, $driverId) {
    return Lap::where('race_id', $raceId)
              ->where('driver_id', $driverId)
              ->orderBy('lap_time')
              ->first();
}

// Compare two laps
public function compareLaps($lap1, $lap2) {
    $lap1Ms = $this->convertLapTimeToMilliseconds($lap1->lap_time);
    $lap2Ms = $this->convertLapTimeToMilliseconds($lap2->lap_time);
    return $lap1Ms < $lap2Ms;
}
```

## ğŸ« TICKET MODEL FUNCTIONS (TicketController)
## ================================================

### Ticket Status Functions:
```php
// Check if ticket is expired
public function isTicketExpired($ticket) {
    return $ticket->expiry_date < now()->toDateString();
}

// Check if ticket is active
public function isTicketActive($ticket) {
    return $ticket->status === 'active' && !$this->isTicketExpired($ticket);
}

// Generate unique ticket code
public function generateTicketCode() {
    do {
        $code = 'TKT-' . strtoupper(uniqid());
    } while (Ticket::where('ticket_code', $code)->exists());
    return $code;
}
```

## ğŸ† STANDING MODEL FUNCTIONS (StandingController)
## =================================================

### Championship Functions:
```php
// Get driver championship standings
public function getDriverChampionship($year) {
    return Standing::with(['driver', 'team'])
                  ->where('year', $year)
                  ->orderBy('points', 'desc')
                  ->get();
}

// Get constructor championship standings
public function getConstructorChampionship($year) {
    return Standing::with(['team'])
                  ->where('year', $year)
                  ->selectRaw('team_id, SUM(points) as total_points')
                  ->groupBy('team_id')
                  ->orderBy('total_points', 'desc')
                  ->get();
}

// Get top N drivers
public function getTopDrivers($year, $limit = 10) {
    return Standing::where('year', $year)
                  ->orderBy('points', 'desc')
                  ->limit($limit)
                  ->get();
}

// Get driver's championship position
public function getChampionshipPosition($standing) {
    return Standing::where('year', $standing->year)
                  ->where('points', '>', $standing->points)
                  ->count() + 1;
}

// Check if driver is championship leader
public function isChampionshipLeader($standing) {
    $maxPoints = Standing::where('year', $standing->year)->max('points');
    return $standing->points === $maxPoints;
}

// Get points gap to leader
public function getPointsGapToLeader($standing) {
    $leaderPoints = Standing::where('year', $standing->year)->max('points');
    return $leaderPoints - $standing->points;
}

// Get points gap to next driver
public function getPointsGapToNext($standing) {
    $nextDriverPoints = Standing::where('year', $standing->year)
                               ->where('points', '>', $standing->points)
                               ->min('points');
    return $nextDriverPoints ? $nextDriverPoints - $standing->points : null;
}
```

## ğŸ“Š MODEL ROLES EXPLANATION
## ===========================

### ğŸ‘¤ USER MODEL
**Role**: Authentication & Authorization
**Contains**: User data, roles, permissions (Laratrust)
**Relationships**: clients(), teams()

### ğŸŸï¸ CLIENT MODEL  
**Role**: Customer/Ticket Buyer Management
**Contains**: Client identification (CIN, phone)
**Relationships**: user(), tickets()

### ğŸ TEAM MODEL
**Role**: F1 Team Information
**Contains**: Team details, location, principal, etc.
**Relationships**: user(), drivers(), cars()

### ğŸï¸ DRIVER MODEL
**Role**: F1 Driver Information  
**Contains**: Personal info, nationality, team assignment
**Relationships**: team(), cars(), laps(), standings()
**Accessor**: full_name (first_name + last_name)

### ğŸš— CARS MODEL
**Role**: F1 Car Specifications
**Contains**: Car details, performance specs, status
**Relationships**: team(), driver(), laps()

### ğŸ LAP MODEL
**Role**: Race Lap Time Data
**Contains**: Timing data for each lap
**Relationships**: race(), driver(), team(), car()

### ğŸ« TICKET MODEL
**Role**: Race Ticket Management
**Contains**: Ticket info, dates, status
**Relationships**: race(), client()

### ğŸ† STANDING MODEL
**Role**: Championship Points Tracking
**Contains**: Points and championship data
**Relationships**: team(), driver()

### ğŸ RACE MODEL (if exists)
**Role**: Race Event Information
**Contains**: Race details, dates, location
**Relationships**: laps(), tickets()

## ğŸ¯ CONTROLLER RESPONSIBILITIES
## ==============================

### LapController
- Lap time conversions and calculations
- Race analysis and statistics
- Driver performance comparisons
- Fastest lap tracking

### TicketController  
- Ticket validation and status checks
- Ticket code generation
- Booking and expiry management

### StandingController
- Championship calculations
- Points tracking and analysis
- Driver/Constructor standings
- Position and gap calculations

### TeamController
- Team management and statistics
- Team performance analysis

### DriverController
- Driver management and profiles
- Driver performance tracking
- Career statistics

### CarController
- Car specifications and management
- Performance tracking

## âœ… CLEAN MODEL PRINCIPLE
## ========================
Models should ONLY contain:
âœ… Fillable attributes
âœ… Relationships (belongsTo, hasMany)
âœ… Basic casts
âœ… Simple accessors (like full_name)

Controllers should contain:
âœ… Business logic
âœ… Complex calculations  
âœ… API responses
âœ… Data processing
âœ… Validation logic